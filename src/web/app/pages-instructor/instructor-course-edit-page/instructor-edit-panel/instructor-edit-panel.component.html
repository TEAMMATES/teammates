<div class="card bg-light top-padded">
  <div class="card-header bg-primary text-white text-center">
    <strong>Instructor {{ instructorIndex + 1 }}</strong>
    <div class="card-header-btn-toolbar">
      @if (instructor.joinState === JoinState.NOT_JOINED && editMode === EditMode.EDIT) {
        <button id="btn-resend-invite-{{ instructorIndex + 1 }}" class="btn btn-primary btn-sm" ngbTooltip="Send invitation email to the instructor" placement="top-right"
          [disabled]="!currInstructorCoursePrivilege.canModifyInstructor || instructor.isSavingInstructorEdit"
          (click)="sendRemindJoinEmail.emit()">
          <i class="fa fa-envelope" aria-hidden="true"></i>
          Resend Invite
        </button>
      }
      @if (!instructor.isEditing && editMode === EditMode.EDIT) {
        <button id="btn-edit-instructor-{{ instructorIndex + 1 }}" class="btn btn-primary btn-sm"
          [disabled]="!currInstructorCoursePrivilege.canModifyInstructor || instructor.isSavingInstructorEdit"
          (click)="triggerModelChange('isEditing', true)">
          @if (!instructor.isSavingInstructorEdit) {
            <i class="fa fa-pen" aria-hidden="true"></i>
          }
          Edit
        </button>
      }
      @if (instructor.isEditing || editMode === EditMode.ADD) {
        <button id="btn-cancel-instructor-{{ instructorIndex + 1 }}" class="btn btn-primary btn-sm"
          [disabled]="isSavingNewInstructor"
          (click)="cancelEditing.emit()">
          <i class="fa fa-times" aria-hidden="true"></i>
          Cancel
        </button>
      }
      @if (editMode === EditMode.EDIT) {
        <button id="btn-delete-instructor-{{ instructorIndex + 1 }}" class="btn btn-primary btn-sm"
          ngbTooltip="Delete the instructor from the course" placement="top-right"
          [disabled]="!currInstructorCoursePrivilege.canModifyInstructor || instructor.isSavingInstructorEdit"
          (click)="deleteInstructor.emit()">
          <i class="fa fa-trash" aria-hidden="true"></i>
          Delete
        </button>
      }
    </div>
  </div>

  <div class="card-body text-center" [ngClass]="{'fill-plain': editMode === EditMode.ADD}">
    @if (editMode === EditMode.EDIT && currInstructorCoursePrivilege.canModifyInstructor) {
      <div class="row form-group">
        <label for="google-id-instructor-{{ instructorIndex + 1 }}" class="col-sm-2 control-label">
          Google ID:
        </label>
        @if (instructor.joinState === JoinState.JOINED) {
          <div class="col-sm-9">
            <input id="google-id-instructor-{{ instructorIndex + 1 }}" class="form-control" maxlength="254" [ngModel]="instructor.googleId" disabled>
          </div>
        }
        @if (instructor.joinState === JoinState.NOT_JOINED) {
          <span class="text-danger col-sm-9 text-start margin-bottom-label">
            Not available. Instructor is yet to join this course.
          </span>
        }
      </div>
    }
    <div class="row form-group">
      <label for="name-instructor-{{ instructorIndex + 1 }}" class="col-sm-2 control-label">
        Name:
      </label>
      <div class="col-sm-9">
        <input id="name-instructor-{{ instructorIndex + 1 }}" class="form-control" maxlength="100"
          [ngModel]="instructor.name" (ngModelChange)="triggerModelChange('name', $event)" [disabled]="!instructor.isEditing">
      </div>
    </div>
    <div class="row form-group">
      <label for="email-instructor-{{ instructorIndex + 1 }}" class="col-sm-2 control-label">
        Email:
      </label>
      <div class="col-sm-9">
        <input id="email-instructor-{{ instructorIndex + 1 }}" class="form-control" maxlength="254"
          [ngModel]="instructor.email" (ngModelChange)="triggerModelChange('email', $event)"
          [disabled]="!instructor.isEditing || (instructor.joinState === JoinState.NOT_JOINED && editMode !== EditMode.ADD)">
      </div>
    </div>
    <div class="row form-group">
      <label for="displayed-name-instructor-{{ instructorIndex + 1 }}" class="col-sm-2 control-label">
        <input id="checkbox-display-instructor-{{ instructorIndex + 1 }}" checked=""
          type="checkbox" [ngModel]="instructor.isDisplayedToStudents" aria-label="Enable display name"
          (ngModelChange)="triggerModelChange('isDisplayedToStudents', $event)" [disabled]="!instructor.isEditing">
        &nbsp;
        <span class="ngb-tooltip-class" ngbTooltip="If this is unselected, the instructor will be completely invisible to students. E.g. to give access to a colleague for ‘auditing’ your course">Display to students as:</span>
      </label>
      <div class="col-sm-9">
        <input id="displayed-name-instructor-{{ instructorIndex + 1 }}" class="form-control"
          type="text"
          (ngModelChange)="triggerModelChange('displayedToStudentsAs', $event)"
          [disabled]="!instructor.isDisplayedToStudents || !instructor.isEditing"
          [defaultValue]="'Instructor'"
          placeholder="E.g. Co-lecturer, Teaching Assistant (default: Instructor)"
          [ngModel]="instructor.isDisplayedToStudents ? instructor.displayedToStudentsAs : '(This instructor will NOT be displayed to students)'">
      </div>
    </div>
    <div class="row form-group align-items-start text-start">
      <label class="col-sm-2 control-label text-center text-md-end">
        Access Level:
      </label>
      <div id="access-levels-instructor-{{ instructorIndex + 1 }}" class="col-sm-9">
        @if (instructor.isEditing) {
          @for (role of InstructorPermissionRole | enumToArray; track role) {
            <div class="row">
              <label>
                <input id="{{role + instructorIndex + 1}}" type="radio" [checked]="role === instructor.role" (click)="triggerModelChange('role', role)" [disabled]="!instructor.isEditing">
                {{ role | instructorRoleDescription }}
                @if (role !== InstructorPermissionRole.INSTRUCTOR_PERMISSION_ROLE_CUSTOM) {
                  <button
                  (click)="viewRolePrivilegeModel.emit(role); $event.stopPropagation();" type="button" class="btn btn-link padding-0">View Details</button>
                }
              </label>
            </div>
          }
        }
        @if (!instructor.isEditing) {
          <span id="role-instructor-{{ instructorIndex + 1 }}">{{ instructor.role | instructorRoleDescription }}</span>
          @if (instructor.role !== InstructorPermissionRole.INSTRUCTOR_PERMISSION_ROLE_CUSTOM) {
            <button
            (click)="viewRolePrivilegeModel.emit(instructor.role); $event.stopPropagation();" type="button" class="btn btn-link padding-0">View Details</button>
          }
        }
      </div>
    </div>

    @if (instructor.isEditing && instructor.role === InstructorPermissionRole.INSTRUCTOR_PERMISSION_ROLE_CUSTOM) {
      <tm-custom-privilege-setting-panel class="text-start" id="custom-access-instructor-{{ instructorIndex + 1 }}"
        [permission]="this.instructor.permission" (permissionChange)="triggerModelChange('permission', $event)"
      [allSections]="this.allSections" [allSessions]="this.allSessions"></tm-custom-privilege-setting-panel>
    }

    @if (instructor.isEditing) {
      <div>
        <button id="btn-save-instructor-{{ instructorIndex + 1 }}" class="btn btn-success" type="button" (click)="saveInstructor.emit()" [disabled]="instructor.isSavingInstructorEdit || isSavingNewInstructor">
          @if (instructor.isSavingInstructorEdit || isSavingNewInstructor) {
            <tm-ajax-loading></tm-ajax-loading>
          }
          @if (editMode === EditMode.EDIT) {
            <span>Save changes</span>
          }
          @if (editMode === EditMode.ADD) {
            <span>Add Instructor</span>
          }
        </button>
      </div>
    }
  </div>
</div>
